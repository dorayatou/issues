<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>fetch mock progress Test</title>
</head>
<body>
   <script>
       document.cookie = 'name=ywj';
       let index = 0;
       function sonsume(reader) {
           var total = 0;
           return new Promise((resolve, reject) => {
                function pump() {
                    reader.read().then(({done, value}) => {
                        index++;
                        if (done) {
                            resolve();
                            return;
                        }
                        total += value.byteLength;
                        console.log(`${index} ----- received ${value.byteLength} bytes (${total} bytes in total)`);
                        pump();
                    }).catch(reject);
                }
                pump();
           });
       }

       let url1 = 'https://tests3in.autohome.com.cn/advrmodel2/VR/Fam0di/xinchebeijing.mp3';
       let url2 = 'http://x.autoimg.cn/bi/mda/ahas_head.min.js?v=20170916';
       let header = new Headers({
            'Content-Type': 'text/html'
       });
        fetch(url2, {mode: 'cors', header})
            .then(res => {
                console.log(res);
                sonsume(res.body.getReader())
            })
            .then((data) => {
                console.log(`consumed the entire body without keeping the whole thing in memory!`);
                console.log(data);
            })
            .catch(e => {console.log('something went wrong:' + e)});
   </script>
</body>
</html>